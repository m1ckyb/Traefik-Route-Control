{% extends "base.html" %}

{% block content %}
<div class="header-row">
    <h2>Services</h2>
    <a href="/services/new" class="btn btn-primary">+ Add Service</a>
</div>

{% if services %}
<div class="services-grid">
    {% for service in services %}
    <div class="service-card" data-service-id="{{ service.id }}">
        <div class="service-header">
            <h3>{{ service.name }}</h3>
            <span class="status-badge {% if service.enabled %}status-online{% else %}status-offline{% endif %}">
                {% if service.enabled %}ONLINE{% else %}OFFLINE{% endif %}
            </span>
        </div>
        
        <div class="service-info">
            <div class="info-row">
                <strong>Router:</strong> <code>{{ service.router_name }}</code>
            </div>
            <div class="info-row">
                <strong>Service:</strong> <code>{{ service.service_name }}</code>
            </div>
            <div class="info-row">
                <strong>Target:</strong> <code>{{ service.target_url }}</code>
            </div>
            <div class="info-row">
                <strong>Prefix:</strong> <code>{{ service.subdomain_prefix }}</code>
            </div>
            {% if service.enabled and service.current_hostname %}
            <div class="info-row">
                <strong>Current URL:</strong> 
                <a href="https://{{ service.current_hostname }}" target="_blank" class="url-link">
                    https://{{ service.current_hostname }}
                </a>
            </div>
            {% endif %}
        </div>
        
        <div class="service-actions">
            {% if service.enabled %}
            <button class="btn btn-warning" onclick="toggleService({{ service.id }}, false, event)">
                üõë Turn Off
            </button>
            <button class="btn btn-secondary" onclick="rotateService({{ service.id }}, event)">
                üîÑ Rotate URL
            </button>
            {% else %}
            <button class="btn btn-success" onclick="toggleService({{ service.id }}, true, event)">
                üöÄ Turn On
            </button>
            {% endif %}
            <a href="/services/{{ service.id }}/edit" class="btn btn-secondary">‚úèÔ∏è Edit</a>
            <button class="btn btn-danger" data-service-name="{{ service.name | e }}" onclick="deleteService({{ service.id }}, this.dataset.serviceName)">
                üóëÔ∏è Delete
            </button>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <p>No services configured yet.</p>
    <a href="/services/new" class="btn btn-primary">Add Your First Service</a>
</div>
{% endif %}

<div class="firewall-status">
    <h3>Firewall Status</h3>
    <div class="status-indicator" id="firewall-status">
        <span class="loading">Checking...</span>
    </div>
</div>

<script>
// Load firewall status
fetch('/api/firewall-status')
    .then(r => r.json())
    .then(data => {
        const el = document.getElementById('firewall-status');
        el.innerHTML = `<span class="status-badge status-${data.status.toLowerCase()}">${data.status}</span>`;
    })
    .catch(err => {
        document.getElementById('firewall-status').innerHTML = '<span class="error">Error loading status</span>';
    });
</script>
{% endblock %}
