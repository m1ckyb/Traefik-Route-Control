{% extends "base.html" %}

{% block title %}{% if service %}Edit Service{% else %}Add Service{% endif %} - Traefik Route Control{% endblock %}

{% block content %}
<div class="form-container">
    <h2>{% if service %}Edit Service{% else %}Add New Service{% endif %}</h2>
    
    <form method="POST" class="service-form">
        <div class="form-group">
            <label for="name">Service Name</label>
            <input type="text" id="name" name="name" required 
                   value="{{ service.name if service else '' }}"
                   placeholder="e.g., Jellyfin, Sonarr, etc.">
            <small>A friendly name to identify this service</small>
        </div>
        
        <div class="form-group">
            <label for="router_name">Router Name</label>
            <input type="text" id="router_name" name="router_name" required 
                   value="{{ service.router_name if service else '' }}"
                   placeholder="e.g., jellyfin-secure">
            <small>Unique Traefik router name (alphanumeric and dashes only)</small>
        </div>
        
        <div class="form-group">
            <label for="service_name">Service Name (Traefik)</label>
            <input type="text" id="service_name" name="service_name" required 
                   value="{{ service.service_name if service else '' }}"
                   placeholder="e.g., jellyfin-service">
            <small>Traefik service name for load balancer</small>
        </div>
        
        <div class="form-group">
            <label for="target_url">Target URL</label>
            <input type="text" id="target_url" name="target_url" required 
                   value="{{ service.target_url if service else '' }}"
                   placeholder="http://192.168.1.10:8096">
            <small>Internal URL where the service is accessible</small>
        </div>
        
        <div class="form-group">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <label for="subdomain_prefix">Subdomain Prefix</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 0.85rem; color: var(--text-dim);">Randomize Suffix <span class="tooltip-icon" data-tooltip="If enabled, appends a random string to the prefix. If disabled, uses the prefix as the exact subdomain.">‚ÑπÔ∏è</span></span>
                    <div class="switch-75">
                        <label class="switch">
                            <input type="checkbox" id="random_suffix" name="random_suffix" {% if not service or service.random_suffix != 0 %}checked{% endif %} onchange="updatePrefixHelp()">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
            </div>
            <input type="text" id="subdomain_prefix" name="subdomain_prefix" required 
                   value="{{ service.subdomain_prefix if service else '' }}"
                   placeholder="jf" maxlength="63">
            <small id="prefix-help">Short prefix for rotating subdomains (e.g., 'jf' creates jf-abc123.domain.com)</small>
        </div>
        
        <div class="form-group">
            <label for="hass_entity_id">Home Assistant Entity ID (optional)</label>
            <input type="text" id="hass_entity_id" name="hass_entity_id" 
                   value="{{ service.hass_entity_id if service else '' }}"
                   placeholder="input_text.jellyfin_url">
            <small>Specific entity ID for this service. Leave empty to use global setting.</small>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                {% if service %}üíæ Save Changes{% else %}‚ûï Add Service{% endif %}
            </button>
            <a href="/" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
function updatePrefixHelp() {
    const isRandom = document.getElementById('random_suffix').checked;
    const helpText = document.getElementById('prefix-help');
    const input = document.getElementById('subdomain_prefix');
    
    if (isRandom) {
        helpText.innerHTML = "Short prefix for rotating subdomains (e.g., 'jf' creates <code>jf-abc123.domain.com</code>)";
        input.placeholder = "jf";
    } else {
        helpText.innerHTML = "Full subdomain to use (e.g., 'jellyfin' creates <code>jellyfin.domain.com</code>)";
        input.placeholder = "jellyfin";
    }
}

// Initialize on load
document.addEventListener('DOMContentLoaded', updatePrefixHelp);
</script>
{% endblock %}
